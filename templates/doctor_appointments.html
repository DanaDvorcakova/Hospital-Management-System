{% extends "base.html" %}

{% block title %}My Appointments{% endblock %}

{% block content %}

<!-- Welcome message with the doctor's name -->
<h3 class="mb-4">Welcome {{ doctor.name }}</h3>
<h4>ðŸ“… Your Appointments</h4>

<!-- Search Box for filtering appointments -->
<div class="row">
    <div class="col-12 col-md-8 col-lg-6">
        <input id="appointmentsSearch" class="form-control mb-3" type="text" placeholder="Search by doctor or status" value="{{ request.args.get('search', '') }}">
    </div>
</div>

<!-- Appointments Table -->
<table class="table table-striped table-bordered align-middle" id="appointmentsTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Patient</th>
            <th>Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Loop through each appointment and display its details -->       
        {% for appt in appointments %}
        <tr>
            <td>{{ appt.id }}</td>
            <td>{{ appt.patient.name }}</td>
            <td>{{ appt.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ appt.medical_record.id }}</td>

            <td>
                <!-- Status of the appointment (Completed or Pending) -->
                {% if appt.status == "Completed" %}
                    <span class="badge bg-success">Completed</span>
                {% else %}
                    <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
            </td>
            
            <td class="action-column">
                <!-- Check if the appointment has a medical record -->
                {% if appt.medical_record %}
                    <a href="{{ url_for('edit_medical_record', record_id=appt.medical_record.id) }}" class="btn btn-warning btn-sm">Edit Record</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination -->  
{% set paginator = appointments %}
{% set endpoint = 'doctor_appointments' %}
{% set query_params = {} %}
{% include 'pagination.html' %}

{% endblock %}


